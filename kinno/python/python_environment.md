# set up Python environment by venv

## TODO

* [ ] Mac，Ubuntu，Windownsに対応
* [ ] venvを使った単一バージョンでのPython実行環境
* [ ] pyenv，anacondaはなるべく使わない．ただしWindownsはパッケージを用意するのが面倒なのでanacondaを使用したほうがよいかも

## Python仮想環境について

ここで言う仮想環境とは，Virtual Box等の仮想化ソフトを使ってゲストOS上でPythonを動かすことではなく，**プロジェクトごとに独立したPython実行環境を作成することを指す．**

独立したPythonの実行環境とは，要はプロジェクトごとにPythonのライブラリ群を切り替えることである．大規模な開発になると，そのプロジェクトでしか使わないようなライブラリがいくつも出てくるので，それらをメインの環境に突っ込みまくるとライブラリの管理が辛くなってくる．こういった場面でプロジェクトごとにPythonの環境を作成すると，管理すべきライブラリが明確になるし，バージョンや依存関係の解消にもつながる．

仮想環境のメリットを書いてはみたが，大規模な開発とかしないし，こんなことしないでシステムや自分でインストールし直した単一のPythonで全部こなせばいいじゃんと思うかもしれない．事実，この研究室でのPythonの使われ方では不必要な運用方法になることがほとんどだと思う．  
正直，記事のネタに書きたいだけという気持ちが9割だが，以下のような場面で有効な運用方法ではないかと思う．

* 院生がゼミで使用するPython実行環境をお試しで作るとき
* 特定のモジュールのバージョンを使い分けたいとき

1番目のように，ある環境を新たに作成して動作を確認したい場面で特に効果を発揮すると思う．一方で，書いてはみたが2番目の状況はあまりないかもしれない．例を挙げておくと，個人的にはnetworkxのバージョン差で生じる描画結果の違いを切り分ける際にPythonを仮想環境で区切って利用している．

### 結局どの環境構築方法がいいのか

「Python 環境構築」でググると山のようにヒットするし，あげく環境構築方法もvirtualenv，pyenv，pyvenv，anacondaなど複数出てくるのでいよいよ訳が分からない．  
よく取り上げられているpyenvやanacondaは導入方法によってはシステムの環境変数やコマンドと競合してしまい，これを解決するために設定や操作が煩雑になりがちである．  
またpyvenvは[公式リファレンスのvenvの項](https://docs.python.jp/3/library/venv.html)に

> 注釈 pyvenv スクリプトは Python 3.6 で非推奨となり、代わりに python3 -m venv を使い、仮想環境を動かす Python インタープリタを取り違える可能性を防ぎやすくします。

という文言が盛り込まれているように，最新のPython環境で使用することはおすすめできない．

ここでは，公式でサポートされていてシンプルに運用できるツールの**venv**を使用して開発環境を構築する方法をまとめていく．

## 前提となる環境

* Python3.5以上であること
* Pythonは1種類のバージョンのみ使用する

## venvとは何か

venvもPython仮想環境作成ツールの一種である．もともとはvirtualenvという名前のサードパーティのツールであったがバージョン3.3よりモジュールに組み込まれ，公式にサポートされるツールとなった．pyenvやanacondaは複数のバージョンのPythonを切り替えて使用することができるが，venvは単一バージョンのみ使用し，そのバージョンをもとに作成した仮想環境を操作することができる．

## インストール方法

### Ubuntu

aptからvenvモジュールをインストールする．

```text
$ sudo apt-get install python3-venv
```

### MacOS

homebrewやインストーラーからインストールしたPythonには初めからvenvモジュールが付属している．

### Windows

あほ

## 使い方

myenvという名前の仮想環境を作成し操作する例を示す．

* 仮想環境の作成

```bash
$ python3 -m venv ~/myenv
```

* 仮想環境へ切り替え

```bash
$ source ~/myenv/bin/activate
(myenv)$ # 切り替えが成功するとプロンプトに仮想環境名が表示される
```

あとはpipから必要なライブラリを適宜インストールして環境を構築していけばよい

* 仮想環境の終了

```bash
(myenv)$ deactivate
```

## まとめ

シンプルに使える仮想環境構築ツールvenvを紹介した．記事中で触れた他のツールはPythonのバージョンを複数使うことができるが，大抵は1つのバージョンを使うことができれば事足りるので，やはりvenvのシンプルな運用方法はとっつきやすいと思う．  
Qiitaで思考停止してpyenvを勧める記事を書いている勢を見て疲弊するより，venvでササッと環境を作ってバリバリに開発を進めていったほうがいいなと記事を書いていて思いました．おしまい．

